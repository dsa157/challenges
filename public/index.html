<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Challenges</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #6c757d;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .search-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .search-form {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }
        
        select, input, button {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            align-self: flex-end;
            padding: 0.5rem 1.5rem;
        }
        
        button:hover {
            background-color: #3a5a80;
        }
        
        .results {
            margin-top: 2rem;
        }
        
        .result-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }
        
        .result-title {
            margin: 0;
            color: var(--primary);
        }
        
        .result-source {
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        .result-content {
            margin: 0;
            line-height: 1.6;
        }
        
        .no-results {
            text-align: center;
            color: var(--secondary);
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--secondary);
        }
        
        .spinner {
            border: 3px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid #dee2e6;
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Daily Challenges</h1>
        <p>Find your daily creative challenges</p>
    </header>
    
    <main>
        <div class="search-container">
            <form id="searchForm" class="search-form">
                <div class="form-group">
                    <label for="month">Month</label>
                    <select id="month" name="month" required>
                        <option value="">Select a month</option>
                        <!-- Months will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="day">Day</label>
                    <input type="number" id="day" name="day" min="1" max="31" placeholder="Day (1-31)">
                </div>
                
                <button type="submit" id="searchButton">Search</button>
            </form>
            
            <div id="currentDate" style="font-style: italic; color: #6c757d; text-align: right;"></div>
        </div>
        
        <div class="spinner" id="spinner"></div>
        
        <div id="results" class="results">
            <!-- Results will be inserted here -->
        </div>
    </main>
    
    <footer>
        <p>Â© 2025 Daily Challenges | <a href="https://github.com/dsa157/challenges" target="_blank" style="color: var(--primary); text-decoration: none;">GitHub</a></p>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchForm = document.getElementById('searchForm');
            const resultsDiv = document.getElementById('results');
            const spinner = document.getElementById('spinner');
            const currentDateSpan = document.getElementById('currentDate');
            
            // Set current date in the UI
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            currentDateSpan.textContent = `Today is ${now.toLocaleDateString('en-US', options)}`;
            
            // Set default day to today
            const dayInput = document.getElementById('day');
            dayInput.placeholder = now.getDate();
            
            // Fetch available months and populate dropdown
            fetch('/api/months')
                .then(response => response.json())
                .then(data => {
                    const monthSelect = document.getElementById('month');
                    data.forEach(month => {
                        const option = document.createElement('option');
                        option.value = month;
                        // Format month name (e.g., 'jun' -> 'June')
                        const monthName = new Date(2000, ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 
                            'jul', 'aug', 'sep', 'oct', 'nov', 'dec'].indexOf(month), 1)
                            .toLocaleString('default', { month: 'long' });
                        option.textContent = monthName;
                        
                        // Select current month by default
                        if (month === ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 
                            'jul', 'aug', 'sep', 'oct', 'nov', 'dec'][now.getMonth()]) {
                            option.selected = true;
                        }
                        
                        monthSelect.appendChild(option);
                    });
                    
                    // Trigger search for today's challenges
                    searchChallenges({
                        month: monthSelect.value,
                        day: now.getDate().toString()
                    });
                })
                .catch(error => {
                    console.error('Error loading months:', error);
                    resultsDiv.innerHTML = `
                        <div class="no-results">
                            <p>Error loading available months. Please try again later.</p>
                        </div>
                    `;
                });
            
            // Handle form submission
            searchForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const month = document.getElementById('month').value;
                const day = document.getElementById('day').value || new Date().getDate();
                
                searchChallenges({ month, day });
            });
            
            function searchChallenges({ month, day }) {
                if (!month) return;
                
                // Show loading spinner
                spinner.style.display = 'block';
                resultsDiv.innerHTML = '';
                
                // Make API request
                fetch(`/api/search?month=${month}&day=${day}`)
                    .then(response => response.json())
                    .then(data => {
                        displayResults(data);
                    })
                    .catch(error => {
                        console.error('Error searching challenges:', error);
                        resultsDiv.innerHTML = `
                            <div class="no-results">
                                <p>Error loading challenges. Please try again.</p>
                            </div>
                        `;
                    })
                    .finally(() => {
                        // Hide loading spinner
                        spinner.style.display = 'none';
                    });
            }
            
            function displayResults(data) {
                if (!data.results || data.results.length === 0) {
                    resultsDiv.innerHTML = `
                        <div class="no-results">
                            <p>No challenges found for the selected date.</p>
                        </div>
                    `;
                    return;
                }
                
                // Format the date for display
                const monthName = new Date(2000, ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 
                    'jul', 'aug', 'sep', 'oct', 'nov', 'dec'].indexOf(data.results[0].lineContent.toLowerCase().substring(0, 3)), 1)
                    .toLocaleString('default', { month: 'long' });
                
                resultsDiv.innerHTML = `
                    <h2>Challenges for ${monthName} ${data.results[0].lineContent.match(/\d+/)[0]}</h2>
                `;
                
                // Display each result
                data.results.forEach(result => {
                    const resultElement = document.createElement('div');
                    resultElement.className = 'result-card';
                    resultElement.innerHTML = `
                        <div class="result-header">
                            <h3 class="result-title">${result.matches[0]}</h3>
                            <span class="result-source">${result.file}</span>
                        </div>
                        <p class="result-content">${result.lineContent}</p>
                    `;
                    resultsDiv.appendChild(resultElement);
                });
            }
        });
    </script>
</body>
</html>
